<!doctype html>
<html lang="zh-cn">
<head>
<!-- Required meta tags -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<!-- Bootstrap CSS -->
<link rel="stylesheet" href="/css/bootstrap.min.css">

<!-- Loding font -->
<link href="/css/fonts.css" rel="stylesheet">

<!-- Custom Styles -->
<link rel="stylesheet" type="text/css" href="/css/register.css">

<title>注册 - FuCubeCloud</title>

<!-- 引入jQuery -->
<script src="/js/sweetalert.min.js"></script>
<script src="/js/jquery-3.6.0.min.js"></script>
</head>
<body>

<!-- Backgrounds -->

<div id="login-bg" class="container-fluid">

  <div class="bg-img"></div>
  <!-- <div class="bg-color"></div> -->
</div>

<!-- End Backgrounds -->

<div class="container" id="login">
	<div class="row justify-content-center">
		<div class="col-lg-8">
			<div class="login">
				<h2>FuCube注册</h2>
				<!-- Registration form -->
				<form id="registration-form">
					<div class="form-group">
						<input type="username" class="form-control" id="username" placeholder="电子邮箱" required>
					</div>
					<div class="form-group">
						<input type="password" class="form-control" id="password" placeholder="密码" required>
					</div>
					<div class="form-group">
						<input type="password" class="form-control" id="confirm-password" placeholder="确认密码" required>
					</div>
					<script src="https://www.recaptcha.net/recaptcha/api.js" async defer></script>
					<!-- <div class="form-group">
						<input type="text" class="form-control" id="captcha" placeholder="通行码" required>
					</div> -->
					<div class="g-recaptcha" data-callback="robotVerified" data-sitekey="6LeIxAcTAAAAAJcZVRqyHh71UMIEGNQ_MXjiZKhI"></div>
					<!-- 这段可以跑一下试试 还没试过 ↑  参考文档 https://www.jianshu.com/p/a0c049795014 -->
					<div class="form-check">
						<label class="already-have-account"><a href="/login">已有账号? 登录</a></label>
					</div>
					
					<br>
					<button type="submit" class="btn btn-lg btn-block btn-success" id="submit-btn">注册</button>
				</from>
				<!-- End Registration form -->

			</div>
			<span style="color:white;">Copyright &copy; 2024 FuCubeCloud 芙方云 All rights reserved.</span> 
		</div>
	</div>
</div>
<script>
// jQuery ready function to ensure the DOM is fully loaded before executing any code
$(document).ready(function() {
    // Attach a click event handler to the submit button
    $('#submit-btn').click(function(event) {
        // Prevent the default form submission behavior
        event.preventDefault();

        // Get values from the input fields
        var username = $('#username').val();
        var password = $('#password').val();
        var confirmPassword = $('#confirm-password').val();
        // Assuming the reCAPTCHA token is stored in a global variable called 'token'
        var token = grecaptcha.getResponse();

        // Check if any of the fields are empty or if passwords do not match
        if (!username || !password || !confirmPassword || !token || password !== confirmPassword) {
            swal("Error", "请填写所有字段！", "error");
            return;
        }

        // Prepare the data to send
        var data = {
            username: username,
            password: password,
			confirmPassword: confirmPassword,
            'g-recaptcha-response': token
        };

        // Send an AJAX request
		$.ajax({
			url: '/api/reg', // Replace this with your actual registration endpoint
			type: 'POST',
			data: data,
			dataType: 'json', // Specify that you expect JSON data back
			success: function(response, textStatus, xhr) {
				// Check the HTTP status code from the response object
				swal("Success", response.message, "success");
			},
			error: function(xhr, status, error) {
				// Handle any errors that occur during the request
				var responseText = xhr.responseText;
				try {
					var responseJson = JSON.parse(responseText);
					if (typeof responseJson === 'object' && responseJson !== null) {
						// 确保解析结果是一个对象
						if (responseJson.error) {
							// 如果 JSON 中有 'error' 键，使用它
							swal("Error", responseJson.error, "error");
						} else {
							// 否则，使用一个默认的错误消息
							swal("Error", "An unexpected error occurred.", "error");
						}
					} else {
						// 如果响应不是有效的 JSON 对象，显示原始文本
						swal("Error", "Server response: " + responseText, "error");
					}
				} catch (e) {
					// 如果解析 JSON 失败，显示原始文本
					swal("Error", "Server response: " + responseText, "error");
				}
			}
		});
    });
});
</script>
</body>
</html>